---
title: "Written HW 4 - Wine Quality"
author: "Malia Cortez, Ava Delanty"
date: "2023-05-23"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(RSpectra)
library(plotly)
library(gridExtra)
library(softImpute)
library(readr)
library(ggplot2)
```

## Load in Data

```{r chunk1}
red <- read.csv('/Users/aves/DATA5322-HW4/data/winequality-red.csv',sep=',')
white <-  read.csv('/Users/aves/DATA5322-HW4/data/winequality-white.csv',sep=',')

red2 <- read.csv('../data/winequality-red.csv', sep = ",")
white2 <- read.csv('../data/winequality-white.csv', sep = ",")
```

## Exploratory Analysis 

```{r chunk2}
red
```

## Models

Unsupervised:

The predictor variable is quality 
```{r}
unique(red$quality)
```
Let's assign 3-5 as low quality wine and 6-8 as high quality wine. 

### PCA:
```{r}
# red wine X input
# get counts for each quality category
quality.counts <- red2 %>% 
  group_by(quality) %>%
  count()

ggplot(quality.counts, mapping = aes(quality, n)) +
  geom_col() +
  labs(x = "Quality", y = "Count", title = "Count of Observations for Category of Quality")

X <- red2 %>% select(-quality)

# scale data for SVD
scaled_X <- scale(X)

# use PCA with scaled data
pr.out <- prcomp(X, scale = TRUE)

# get percent variance explained by principal components
pve <- pr.out$sdev^2 / sum(pr.out$sdev^2)

plot(pve, ylab = "Proportion of Variance Explained", xlab = "Principal Component", main = "Variance by PC in Red Wine Data")

# get most weighted variables
## for the first PC, fixed acidity, citric acid, pH, and density are all highly weighted
## pH is negatively weighted, which we can see when we remove the absolute value
pr.out$rotation[,1] %>% sort(decreasing=TRUE)
pr.out$rotation[,1] %>% abs() %>% sort(decreasing=TRUE)

## second PC
## total sulfur dioxide, free sulfur dioxide, volatile acidity, residual sugar all highly weighted
pr.out$rotation[,2] %>% abs() %>% sort(decreasing = TRUE)

# plot along first two principal components
toplot <- data.frame(pr.out$x)

```





K-means clustering:
Red Wine omitting NAs and deselecting quality predictor variable and scaling the data frame
```{r}
red_data = red %>% na.omit() %>% select(-c(quality))
scaled <- scale(red_data)
```

```{r}
km.out <- kmeans(scaled, 2, nstart = 20)
plot(scaled[,11],scaled[,10],col = (km.out$cluster + 1),
    main = "K-Means Clustering Results with K = 2",
    xlab = "alcohol", ylab = "sulphates", pch = 20, cex = 2)
km.out$tot.withinss
```
The total within group sum of squares is 14321.16

Plotting the proportion of variance explained using the d vector. 
```{r}
S <- svd(scaled)
plot(S$d/sum(S$d))
```

Hierarchical Clustering:





Supervised Model: 

